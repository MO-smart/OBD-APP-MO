// قاعدة البيانات تاع أكواد الأعطال بالدارجة
const errorCodes = {
    "P0420": {
        name_dz: "الكود P0420: الكاتاليزور عيان / ضعيف",
        description_dz: "هاد الكود يقول بلي الكاتاليزور (اللي ينقي الدخان تاع الطونوبيل) راهو عيان، ولازم يتبدل ولا يتصلح. ممكن يكون المشكل من الكاتاليزور بيدو ولا من السوندا تاع الأوكسيجين.",
        symptoms_dz: "قادر الطونوبيل تولي ثقيلة، تستهلك بزاف ليسونس، ولا الشيك إنجين (Check Engine) يشعل في الطابلو.",
        causes_dz: "الأسباب المتداولة هي: الكاتاليزور خاسر، السوندا تاع الأوكسيجين (قبل ولا بعد الكاتاليزور) عيانة، كاين فويت (تسريب) في الشاكمان، ولا كاين بروبلام في السيستام تاع الحريق (الكومبيستيو).",
        solution_dz: "لازم تفحص السوندات تاع الأوكسيجين، تشوف الكاتاليزور، تتأكد بلي ماكاش فويت في الشاكمان، وتصلح أي مشكل في سيستام الحريق (كيما لي بوجي ولا لي بوبين)."
    },
    "P0301": {
        name_dz: "الكود P0301: بروبلام في الشعلة تاع السيلاندر 1",
        description_dz: "هاد الكود يقول بلي الكالكيلاتور لقا مشكل في الاحتراق تاع ليسونس داخل السيلاندر رقم واحد.",
        symptoms_dz: "تقدر الطونوبيل ترجف، تولي ثقيلة في الزيادة، ولا الشيك إنجين (Check Engine) يشعل ومرات يقعد يكليكيوتي (يرمش) في الحالات الصعيبة.",
        causes_dz: "الأسباب ممكن تكون: البوجي ولا البوبينة تاع السيلاندر 1 خاسرين، لانجيكتور (حاقن الوقود) تاع السيلاندر 1 عيان، كاين فويت (تسريب) هوا في لا سيركوي تاع الريح (مشعب السحب)، ولا كاين مشكل في الكومبريسيو تاع السيلاندر.",
        solution_dz: "لازم تشوف البوجي ولا البوبينة وتبدلهم إذا لازم، تفحص لانجيكتور، تحوس على الفويت تاع الهوا، ولا دير تست (اختبار) تاع الكومبريسيو للسيلاندر."
    },
    "P0171": {
        name_dz: "الكود P0171: خليط ليسونس وريح قليل (فَقير)",
        description_dz: "هاد الكود يقول بلي الريح كاين بزاف وليسونس قليل في الشمبرة الأولى تاع الموتور، يعني الخليط راهو 'فقير'.",
        symptoms_dz: "تقدر الطونوبيل تولي ضعيفة، الموتور ما يقعدش ستابل، ولا ما تنوضش مليح، وزيد الشيك إنجين يشعل.",
        causes_dz: "كاين فويت (تسريب) هوا في السيستام تاع السحب، سوندا تاع الريح (MAF Sensor) موسخة ولا خاسرة، بومبة تاع ليسونس ولا الفيلتر تاعها عيانين، لي زانجيكتور مبلوكيين، ولا سوندا الأوكسيجين فيها مشكل.",
        solution_dz: "لازم تفحص لا سيركوي تاع الريح على الفويتات، تنقي ولا تبدل سوندا MAF، تشوف بريسيو (ضغط) تاع ليسونس ولي زانجيكتور، وتفحص لي سوندات تاع الأوكسيجين."
    },
    "U0100": {
        name_dz: "الكود U0100: الكالكيلاتور تاع الموتور مقطوع عليه الاتصال",
        description_dz: "هاد الكود يقول بلي الكالكيلاتور (الكمبيوتر) تاع الموتور ما راهوش يتواصل مليح مع لي كالكيلاتور الآخرين في الطونوبيل عبر شبكة CAN Bus.",
        symptoms_dz: "الطونوبيل تقدر ما تنوضش خلاص، ولا تشوف بزاف صوالح ماشي نورمال فيها، مع الشيك إنجين يشعل وكيما هو لي ضووات الآخرين.",
        causes_dz: "كاين مشكل في لي فيل (الأسلاك) ولا لي كونيكتور (الموصلات) تاع شبكة CAN Bus، الكالكيلاتور تاع الموتور هو لي خاسر، مشكل في الباتري ولا سيستام الشارج، ولا كاين كالكيلاتور واحد آخر هو لي مداير المشكل في الاتصال.",
        solution_dz: "لازم تفحص لي كونيكسيون ولي فيل بين لي كالكيلاتور، تشوف الكالكيلاتور تاع الموتور إذا راهو لاباس بيه، تتأكد بلي الباتري راهي مشارجية مليح، وتفحص لي فيزيبل (الفيوزات) لي عندهم علاقة."
    }
};

// نجيبو العناصر تاع HTML لي حنسحقوهم
const errorCodeInput = document.getElementById('errorCodeInput');
const searchButton = document.getElementById('searchButton');
const welcomeMessage = document.getElementById('welcomeMessage');
const loadingAnimation = document.getElementById('loadingAnimation'); // عنصر أنيميشن التحميل

// الدالة لي تبحث على الكود
function searchCode() {
    const code = errorCodeInput.value.toUpperCase().trim(); // نحولو لحروف كبار ونحيولو لي سباس

    // إظهار أنيميشن التحميل
    loadingAnimation.style.display = 'block';
    
    // إخفاء زر البحث باش ما يدخلوش المستخدم أكواد أخرى أثناء البحث
    searchButton.disabled = true;

    // نديرو تأخير صغير باش تبان الأنيميشن
    setTimeout(() => {
        // إخفاء أنيميشن التحميل
        loadingAnimation.style.display = 'none';
        searchButton.disabled = false; // تفعيل زر البحث مرة أخرى

        if (!code) { // إذا ما دخلش والو
            alert('يا خويا، أدخل كود العطل من فضلك!'); // رسالة بسيطة
            return;
        }

        // تحقق بسيط لتنسيق الكود (الحرف الأول لازم يكون P, B, C, U)
        if (!/^[PBCU]\d{4}$/.test(code)) {
            alert('سمحلي خويا، هذا ماشي كود عطل صحيح. لازم تدخل كود كيما P0420 مثلاً، فيه حرف وأربع أرقام.');
            return;
        }

        if (errorCodes[code]) {
            const codeInfo = { ...errorCodes[code], code: code }; // نزيدو الكود للـ object
            // نحفظو البيانات في localStorage باش الصفحة الثانية تقدر تقراها
            localStorage.setItem('currentErrorCode', JSON.stringify(codeInfo));
            
            // ننتقلو للصفحة الثانية (result.html)
            window.location.href = 'result.html';
        } else {
            alert(`سمحلي خويا، الكود "${code}" ماهوش عندنا درك في قاعدة البيانات التجريبية. شوف كود واحد آخر (مثال: P0420 ولا P0301).`);
            // إذا ما صبناش الكود، نمسحو localStorage باش ما تظهرش معلومات قديمة في result.html
            localStorage.removeItem('currentErrorCode'); 
        }
    }, 1500); // تأخير ثانية ونصف (1500 ميلي ثانية) باش تبان الأنيميشن مليح
}

// دالة ترحيب كي تفتح الصفحة
function showWelcomeMessage() {
    setTimeout(() => {
        welcomeMessage.textContent = "يا مرحبا بيك! دخل الكود تاع العطل واكليكي على 'حوس'.";
    }, 1000); // تظهر بعد ثانية من فتح الصفحة
}

// إظهار رسالة ترحيب عند تحميل الصفحة
window.onload = showWelcomeMessage;

// نربطو الزر تاع البحث بالدالة searchCode كي يكليكي عليه المستخدم
searchButton.addEventListener('click', searchCode);

// نقدرو نخليو المستخدم يبحث كي يكليكي على Enter
errorCodeInput.addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
        searchCode();
    }
});

// تغيير Placeholder عند التركيز على مربع الإدخال
errorCodeInput.addEventListener('focus', function() {
    this.placeholder = 'مثلاً: P0420 ولا P0301';
});

// إرجاع Placeholder الأصلي عند مغادرة مربع الإدخال إذا كان فارغا
errorCodeInput.addEventListener('blur', function() {
    if (this.value === '') {
        this.placeholder = 'دخل الكود هنا (مثال: P0420)';
    }
});
